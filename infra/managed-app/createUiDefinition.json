{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": true,
      "basics": {
        "description": "Welcome to **[GraphRAG](https://aka.ms/graphrag)**.",
        "subscription": {
          "constraints": {
            "validations": [
              {
                "permission": "Microsoft.Compute/virtualmachines/write",
                "message": "Must have write permission for the virtual machine."
              }
            ]
          },
          "resourceProviders": [
            "Microsoft.ApiManagement",
            "Microsoft.Authorization",
            "Microsoft.Compute",
            "Microsoft.ContainerRegistry",
            "Microsoft.ContainerService",
            "Microsoft.DocumentDB",
            "Microsoft.Insights",
            "Microsoft.ManagedIdentity",
            "Microsoft.Network",
            "Microsoft.OperationalInsights",
            "Microsoft.Search",
            "Microsoft.Storage",
            "Microsoft.CognitiveServices"
          ]
        },
        "resourceGroup": {
          "constraints": {
            "validations": [
              {
                "isValid": "[not(contains(resourceGroup().name, 'test'))]",
                "message": "Resourceâ€¯group name can't contain 'test'."
              }
            ]
          },
          "allowExisting": false
        },
        "location": {
          "resourceTypes": [
            "Microsoft.ApiManagement/service",
            "Microsoft.Authorization/roleAssignments",
            "Microsoft.CognitiveServices/accounts",
            "Microsoft.ContainerRegistry/registries",
            "Microsoft.ContainerService/managedClusters",
            "Microsoft.DocumentDB/databaseAccounts",
            "Microsoft.Insights/components",
            "Microsoft.Insights/privateLinkScopes",
            "Microsoft.ManagedIdentity/userAssignedIdentities",
            "Microsoft.Network/networkSecurityGroups",
            "Microsoft.Network/privateDnsZones",
            "Microsoft.Network/privateEndpoints",
            "Microsoft.Network/publicIPAddresses",
            "Microsoft.Network/virtualNetworks",
            "Microsoft.OperationalInsights/workspaces",
            "Microsoft.Search/searchServices",
            "Microsoft.Storage/storageAccounts"
          ]
        }
      }
    },
    "basics": [],
    "steps": [
      {
        "name": "apiSettings",
        "label": "API Configuration",
        "description": "Customize GraphRAG API endpoint behavior:",
        "subLabel": {
          "preValidation": "Configure the API settings",
          "postValidation": "Complete"
        },
        "elements": [
          {
            "name": "apimTier",
            "type": "Microsoft.Common.DropDown",
            "label": "APIM Tier",
            "defaultValue": "StandardV2",
            "toolTip": "API Management tier to use.",
            "visible": true,
            "constraints": {
              "allowedValues": [
                {
                  "label": "Developer",
                  "value": "Developer"
                },
                {
                  "label": "StandardV2",
                  "value": "StandardV2"
                }
              ],
              "required": true
            }
          }
        ]
      },
      {
        "name": "aoaiSettings",
        "label": "OpenAI Settings",
        "description": "Customize Azure OpenAI model deployments:",
        "subLabel": {
          "preValidation": "Configure AOAI settings",
          "postValidation": "Complete"
        },
        "elements": [
          {
            "name": "llmModel",
            "type": "Microsoft.Common.DropDown",
            "label": "LLM Model",
            "defaultValue": "gpt-4o",
            "toolTip": "LLM model to use.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "gpt-4o",
                  "value": "gpt-4o"
                },
                {
                  "label": "gpt-4o-mini",
                  "value": "gpt-4o-mini"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "llmModelVersion",
            "type": "Microsoft.Common.DropDown",
            "label": "LLM Model Version",
            "defaultValue": "2024-08-06",
            "toolTip": "LLM model version to use.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "2024-08-06",
                  "value": "2024-08-06"
                },
                {
                  "label": "2024-07-18",
                  "value": "2024-07-18"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "llmModelQuota",
            "type": "Microsoft.Common.TextBox",
            "label": "LLM Model Quota (x1000)",
            "placeholder": "85",
            "defaultValue": "",
            "toolTip": "LLM model quota to use.",
            "constraints": {
              "required": true,
              "regex": "^[1-9][0-9]*$",
              "validationMessage": "Must provide a valid amount (> 0) of LLM model quota."
            },
            "visible": true
          },
          {
            "name": "embeddingModel",
            "type": "Microsoft.Common.DropDown",
            "label": "Embedding Model",
            "defaultValue": "text-embedding-ada-002",
            "toolTip": "Embedding model to use.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "text-embedding-ada-002",
                  "value": "text-embedding-ada-002"
                },
                {
                  "label": "text-embedding-3-large",
                  "value": "text-embedding-3-large"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "embeddingModelQuota",
            "type": "Microsoft.Common.TextBox",
            "label": "Embedding Model Quota (x1000)",
            "placeholder": "100",
            "defaultValue": "",
            "toolTip": "Embedding model quota to use.",
            "constraints": {
              "required": true,
              "regex": "^[1-9][0-9]*$",
              "validationMessage": "Must provide a valid amount (> 0) of embedding model quota."
            },
            "visible": true
          },
          {
            "name": "embeddingModelVersion",
            "type": "Microsoft.Common.DropDown",
            "label": "Embedding Model Version",
            "defaultValue": "2",
            "toolTip": "Embedding model version to use.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "2",
                  "value": "2"
                },
                {
                  "label": "1",
                  "value": "1"
                }
              ],
              "required": true
            },
            "visible": true
          }
        ]
      },
      {
        "name": "kubernetes",
        "label": "Kubernetes",
        "description": "Customize kubernetes settings:",
        "subLabel": {
          "preValidation": "Configure kubernetes settings",
          "postValidation": "Complete"
        },
        "elements": [
          {
            "name": "namespace",
            "type": "Microsoft.Common.TextBox",
            "label": "Namespace",
            "defaultValue": "graphrag",
            "toolTip": "Define a valid k8s namespace.",
            "constraints": {
              "required": true,
              "regex": "^(?!-)[a-z0-9-]{1,253}$",
              "validationMessage": "Only lowercase alphanumeric characters are allowed, with a maximum length of 253 characters. Cannot start with a hyphen."
            }
          }
        ]
      },
      {
        "name": "networking",
        "label": "Networking",
        "description": "Customize networking & security settings:",
        "subLabel": {
          "preValidation": "Configure network settings",
          "postValidation": "Complete"
        },
        "elements": [
          {
            "name": "enablePrivateEndpoints",
            "type": "Microsoft.Common.CheckBox",
            "label": "Enable private endpoints.",
            "toolTip": "Whether or not to use private endpoint connections.",
            "defaultValue": true,
            "constraints": {
              "required": false
            }
          }
        ]
      }
    ],
    "outputs": {
      "resourceGroup": "[resourceGroup().name]",
      "location": "[location()]",
      "apimTier": "[steps('apiSettings').apimTier]",
      "llmModelName": "[steps('aoaiSettings').llmModel]",
      "llmModelQuota": "[int(steps('aoaiSettings').llmModelQuota)]",
      "embeddingModelName": "[steps('aoaiSettings').embeddingModel]",
      "embeddingModelQuota": "[int(steps('aoaiSettings').embeddingModelQuota)]",
      "llmModelVersion": "[steps('aoaiSettings').llmModelVersion]",
      "embeddingModelVersion": "[steps('aoaiSettings').embeddingModelVersion]",
      "publicStorageAccountName": "[steps('StorageaccountSettings').StorageAccountName]",
      "publicStorageAccountKey": "[steps('StorageaccountSettings').StorageAccountKey]""embeddingModelVersion": "[steps('aoaiSettings').embeddingModelVersion]",
      "enablePrivateEndpoints": "[steps('networking').enablePrivateEndpoints]",
      "aksNamespace": "[steps('kubernetes').namespace]"
    }
  }
}